---
title:
- CSP571 DPA Project
- Prediction of Rice price per district in Andhra Pradesh
author:
- Santosh Reddy Edulapalle
- Jobin Joyson
- Venkata Siva Rupesh Akurati
date: "2022-11-07"
output:
  pdf_document: default
  html_document: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Loading Dataset


```{r}
df.rice.farm.harvest.price <- read.csv(unz("Datasets.zip","Datasets/Rice_farm_harvest_price.csv"))

df.rice.area.production.yield <- read.csv(unz("Datasets.zip","Datasets/Rice_area_production_yield.csv"))

df.irrigation.sourcewise.irrigated.area <- read.csv(unz("Datasets.zip","Datasets/Irrigation_sourcewise_irrigated_area.csv"))

df.irrigation.rice.area <- read.csv(unz("Datasets.zip","Datasets/Irrigation_rice_area.csv"))

df.inputs.wages <- read.csv(unz("Datasets.zip","Datasets/Inputs_wages.csv"))

df.inputs.season.fertilizer.consumption <- read.csv(unz("Datasets.zip","Datasets/Inputs_season_fertilizer_consumption.csv"))

df.inputs.fertilizer.consumption <- read.csv(unz("Datasets.zip","Datasets/Inputs_fertilizer_consumption.csv"))

df.environment.temperature.minimum <- read.csv(unz("Datasets.zip","Datasets/Environment_temperature_minimum*.csv"))

df.environment.temperature.maximum <- read.csv(unz("Datasets.zip","Datasets/Environment_temperature_maximum*.csv"))

df.environment.precipitation <- read.csv(unz("Datasets.zip","Datasets/Environment_precipitation*.csv"))

df.environment.evapotranspiration.potential <- read.csv(unz("Datasets.zip","Datasets/Environment_evapotranspiration_potential*.csv"))

df.environment.evapotranspiration.actual <- read.csv(unz("Datasets.zip","Datasets/Environment_evapotranspiration_actual*.csv"))

df.biophysical.soil.type1 <- read.csv(unz("Datasets.zip","Datasets/Biophysical_soil_type.csv"))

df.biophysical.monthly.rainfall <- read.csv(unz("Datasets.zip","Datasets/Biophysical_monthly_rainfall.csv"))

df.biophysical.length.of.growing.period <- read.csv(unz("Datasets.zip","Datasets/Biophysical_length_of_growing_period.csv"))

df.biophysical.landuse <- read.csv(unz("Datasets.zip","Datasets/Biophysical_landuse.csv"))

```


# Data Processing 

Initially, district codes 503,504 were missing in some tables because these districts are formed after state division. So, a lot of NAs were formed while performing joins. Now we gathered latest possible information for all data sets.

## Deleting rows < 1990

Other than environment, entire data sets starts from 1990. So, to get fair results, we are deleting observations from environment data sets that are recorded in years < 1990.

```{r}
#deleting rows less than 1990

del.1990 <- function(df.name){
  df.name <- df.name[df.name$Year >= 1990,]
  return(df.name)
}

df.environment.evapotranspiration.actual <- del.1990(df.environment.evapotranspiration.actual)

df.environment.evapotranspiration.potential <- del.1990(df.environment.evapotranspiration.potential)

df.environment.precipitation <- del.1990(df.environment.precipitation)
df.environment.temperature.maximum <- del.1990(df.environment.temperature.maximum)
df.environment.temperature.minimum <- del.1990(df.environment.temperature.minimum)
```

## Deleting rows > 2015

So, some tables end with 2015 while others end with 2017. Our target table end with Year 2016. So, to get fair results, we are deleting observations from data sets that are recorded in years > 2015.

```{r}
#deleting rows more than 2015

del.2015 <- function(df.name){
  df.name <- df.name[df.name$Year <= 2015,]
  return(df.name)
}

df.biophysical.landuse <- del.2015(df.biophysical.landuse)
df.biophysical.monthly.rainfall <- del.2015(df.biophysical.monthly.rainfall)
df.inputs.fertilizer.consumption <- del.2015(df.inputs.fertilizer.consumption)
df.inputs.season.fertilizer.consumption <- del.2015(df.inputs.season.fertilizer.consumption)
df.inputs.wages <- del.2015(df.inputs.wages)
df.irrigation.rice.area <- del.2015(df.irrigation.rice.area)
df.irrigation.sourcewise.irrigated.area <- del.2015(df.irrigation.sourcewise.irrigated.area)
df.rice.area.production.yield <- del.2015(df.rice.area.production.yield)
df.rice.farm.harvest.price <- del.2015(df.rice.farm.harvest.price)


```


## Handling missing values

(In the ICRISAT website, we are said that missing values are coded as -1).

Process:

1. Initially, we skimmed thourgh all datasets and deleted the records which have -1.
Later after combining all the datasets to single df.all dataframe, we were able to see lot of NAs. After going thorough careful investigation, we found out that since we deleted couple of observations in few datasets, those years-observations were causing NA while joining with other datasets. So, we Handled missing values by taking appropriate years and handling df.input.wages as it is largest missing data.
Additionally, we did not have districts 503,504 for few tables, so we got new and updated datasets.

2. Now we are taking summaries of all tables, and checking if any table has min:-1, so we are handling those specific columns by performing mean of each district in that specific year gap ( 10 year average for missing districts using filter())

3. After doing step1,2 and combining the tables, we still got few NAs after checking summary of each join, we found that - 
df.rice.farm.price table has 2 missing values for district 503,504 for year 1995. and this was not coded as -1. Instead it is completely missing.
same case for df.input.wages for all districts for years 2010,2011.

df.irrigation.sourcewise.irrigated.area$OTHER.WELLS.AREA..1000.ha. = has missing values for districts 50,51 for years 2007.

df.rice.farm.harvest.price$PADDY.HARVEST.PRICE..Rs.per.Quintal. = has missing values for districts 50,51,52,53 for years 1998.

df.inputs.season.fertilizer.consumption$NITROGEN.KHARIF.CONSUMPTION..tons. -> (All the column values of these given districts is missing for these two particular years - 1998,1999 Srikakulam,
Vishakapatnam, East Godavari, West Godavari, Krishna, Guntur, S.P.S.Nellore, Kurnool, Ananthapur, Kadapa YSR, Chitoor, Prakasam, Vijianagaram.)

df.inputs.wages --> There are 132 missing values. (almost 25% data is missing)

## Handling NA values for df.irrigation.sourcewise.irrigated.area

```{r}
library(dplyr)

#replace -1 by NA

df.irrigation.sourcewise.irrigated.area$OTHER.WELLS.AREA..1000.ha. <- ifelse(df.irrigation.sourcewise.irrigated.area$OTHER.WELLS.AREA..1000.ha. == -1, NA,df.irrigation.sourcewise.irrigated.area$OTHER.WELLS.AREA..1000.ha.)

#create a test data frame with 0 rows and 13 columns
test.df <- data.frame(Dist.Code = integer(),
                      Year = integer(),
                      State.Code = integer(),
                      State.Name = character(),
                      Dist.Name = character(),
                      CANALS.AREA..1000.ha. = double(),
                      TANKS.AREA..1000.ha.  = double(),
                      TUBE.WELLS.AREA..1000.ha. = double(),
                      OTHER.WELLS.AREA..1000.ha. = double(),
                      TOTAL.WELLS.AREA..1000.ha. = double(),
                      OTHER.SOURCES.AREA..1000.ha. = double(),
                      NET.AREA..1000.ha.  = double(),
                      GROSS.AREA..1000.ha.   = double(),
                      stringsAsFactors = F
                      )
dist <- c(44,45,46,47,48,49,50,51,52,53,54,503,504)
for(y in dist){
  #we only have missing value for the 2007
  #round1 - 1990:1999
  x <- filter(df.irrigation.sourcewise.irrigated.area, df.irrigation.sourcewise.irrigated.area$Dist.Code == y & df.irrigation.sourcewise.irrigated.area$Year >=1990 & df.irrigation.sourcewise.irrigated.area$Year <= 1999)
  
  x$OTHER.WELLS.AREA..1000.ha. <- ifelse( is.na(x$OTHER.WELLS.AREA..1000.ha.), mean(x$OTHER.WELLS.AREA..1000.ha.,na.rm = T),x$OTHER.WELLS.AREA..1000.ha.)
  test.df <- bind_rows(test.df,x)
    #round2 - 2000:2009
  x1 <- filter(df.irrigation.sourcewise.irrigated.area, df.irrigation.sourcewise.irrigated.area$Dist.Code == y & df.irrigation.sourcewise.irrigated.area$Year >=2000 & df.irrigation.sourcewise.irrigated.area$Year <= 2009)
  
  x1$OTHER.WELLS.AREA..1000.ha. <- ifelse( is.na(x1$OTHER.WELLS.AREA..1000.ha.), mean(x1$OTHER.WELLS.AREA..1000.ha.,na.rm = T),x1$OTHER.WELLS.AREA..1000.ha.)
  test.df <- bind_rows(test.df,x1)
    #round3 - 2010:2019
  x2 <- filter(df.irrigation.sourcewise.irrigated.area, df.irrigation.sourcewise.irrigated.area$Dist.Code == y & df.irrigation.sourcewise.irrigated.area$Year >=2010 & df.irrigation.sourcewise.irrigated.area$Year <= 2019)
  
  x2$OTHER.WELLS.AREA..1000.ha. <- ifelse( is.na(x2$OTHER.WELLS.AREA..1000.ha.), mean(x2$OTHER.WELLS.AREA..1000.ha.,na.rm = T),x2$OTHER.WELLS.AREA..1000.ha.)
  test.df <- bind_rows(test.df,x2)
}
df.irrigation.sourcewise.irrigated.area <- test.df
rm(test.df)
rm(x)
rm(x1)
rm(x2)
```


## Handling NA values for df.rice.farm.harvest.price

```{r}
# Manualy adding 503,504 data


test.df1 <- data.frame(Dist.Code = as.numeric(c(504,503)),
                      Year = as.numeric(1995),
                      State.Code = as.numeric(1),
                      State.Name = "Andhra Pradesh",
                      Dist.Name = c("Prakasam","Vizianagaram"),
                      PADDY.HARVEST.PRICE..Rs.per.Quintal. = as.numeric(-1),
                      stringsAsFactors = F
                      )
df.rice.farm.harvest.price <- bind_rows(df.rice.farm.harvest.price,test.df1)

rm(test.df1)
#replace -1 by NA

df.rice.farm.harvest.price$PADDY.HARVEST.PRICE..Rs.per.Quintal. <- ifelse(df.rice.farm.harvest.price$PADDY.HARVEST.PRICE..Rs.per.Quintal. == -1, NA,df.rice.farm.harvest.price$PADDY.HARVEST.PRICE..Rs.per.Quintal.)

#create a test data frame with 0 rows and 6 columns
test.df <- data.frame(Dist.Code = integer(),
                      Year = integer(),
                      State.Code = integer(),
                      State.Name = character(),
                      Dist.Name = character(),
                      PADDY.HARVEST.PRICE..Rs.per.Quintal. = double(),
                      stringsAsFactors = F
                      )


dist <- c(44,45,46,47,48,49,50,51,52,53,54,503,504)
for(y in dist){
  #we only have missing value for the 1998,1995
  #round1 - 1990:1999
  x <- filter(df.rice.farm.harvest.price, df.rice.farm.harvest.price$Dist.Code == y & df.rice.farm.harvest.price$Year >=1990 & df.rice.farm.harvest.price$Year <= 1999)
  
  x$PADDY.HARVEST.PRICE..Rs.per.Quintal. <- ifelse( is.na(x$PADDY.HARVEST.PRICE..Rs.per.Quintal.), mean(x$PADDY.HARVEST.PRICE..Rs.per.Quintal.,na.rm = T),x$PADDY.HARVEST.PRICE..Rs.per.Quintal.)
  test.df <- bind_rows(test.df,x)
    #round2 - 2000:2009
  x1 <- filter(df.rice.farm.harvest.price, df.rice.farm.harvest.price$Dist.Code == y & df.rice.farm.harvest.price$Year >=2000 & df.rice.farm.harvest.price$Year <= 2009)
  
  x1$PADDY.HARVEST.PRICE..Rs.per.Quintal. <- ifelse( is.na(x1$PADDY.HARVEST.PRICE..Rs.per.Quintal.), mean(x1$PADDY.HARVEST.PRICE..Rs.per.Quintal.,na.rm = T),x1$PADDY.HARVEST.PRICE..Rs.per.Quintal.)
  test.df <- bind_rows(test.df,x1)
    #round3 - 2010:2019
  x2 <- filter(df.rice.farm.harvest.price, df.rice.farm.harvest.price$Dist.Code == y & df.rice.farm.harvest.price$Year >=2010 & df.rice.farm.harvest.price$Year <= 2019)
  
  x2$PADDY.HARVEST.PRICE..Rs.per.Quintal. <- ifelse( is.na(x2$PADDY.HARVEST.PRICE..Rs.per.Quintal.), mean(x2$PADDY.HARVEST.PRICE..Rs.per.Quintal.,na.rm = T),x2$PADDY.HARVEST.PRICE..Rs.per.Quintal.)
  test.df <- bind_rows(test.df,x2)
}
df.rice.farm.harvest.price <- test.df
rm(test.df)
rm(x)
rm(x1)
rm(x2)
```


## Handling NA values of df.input.wages

```{r}

#manually adding all districts data.



rowd1 <-(df.biophysical.soil.type1$Dist.Name)

dist <- c(44,45,46,47,48,49,50,51,52,53,54,503,504)

test.df1 <- data.frame(Dist.Code = as.numeric(dist),
                      Year = as.numeric(rep(c(2010,2011),times = 13)),
                      State.Code = as.numeric(1),
                      State.Name = "Andhra Pradesh",
                      Dist.Name = rowd1,
                      DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day. = as.numeric(-1),
                      DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day. = as.numeric(-1),
                      STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. = as.numeric(-1),
                      STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. = as.numeric(-1),
                      stringsAsFactors = F
                      )


df.inputs.wages <- bind_rows(df.inputs.wages,test.df1)

rm(test.df1)
#replace -1 by NA

df.inputs.wages$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day. <- ifelse(df.inputs.wages$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day. == -1, NA,df.inputs.wages$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.)

df.inputs.wages$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day. <- ifelse(df.inputs.wages$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day. == -1, NA,df.inputs.wages$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.)

df.inputs.wages$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. <- ifelse(df.inputs.wages$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. == -1, NA,df.inputs.wages$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.)

df.inputs.wages$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. <- ifelse(df.inputs.wages$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. == -1, NA,df.inputs.wages$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.)


#filter() from dplyr

#create a test data frame with 0 rows and 9 columns
test.df <- data.frame(Dist.Code = integer(),
                      Year = integer(),
                      State.Code = integer(),
                      State.Name = character(),
                      Dist.Name = character(),
                      DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day. = double(),
                      DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day. = double(),
                      STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. = double(),
                      STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. = double(),
                      stringsAsFactors = F
                      )


dist <- c(44,45,46,47,48,49,50,51,52,53,54,503,504)
for(y in dist){
  #round1 - Years 1990:1999
  x <- filter(df.inputs.wages, df.inputs.wages$Dist.Code == y & df.inputs.wages$Year >=1990 & df.inputs.wages$Year <= 1999)
  
  x$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.), mean(x$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.)
  
  x$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.), mean(x$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.)

  x$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.), mean(x$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.)

  x$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.), mean(x$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.)
  
  test.df <- bind_rows(test.df,x)
  
  #round2 - Years 2000:2009
  x1 <- filter(df.inputs.wages, df.inputs.wages$Dist.Code == y & df.inputs.wages$Year >=2000 & df.inputs.wages$Year <= 2009)
  
  x1$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x1$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.), mean(x1$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x1$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.)
  
  x1$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x1$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.), mean(x1$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x1$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.)

  x1$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x1$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.), mean(x1$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x1$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.)

  x1$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x1$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.), mean(x1$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x1$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.)
  
  test.df <- bind_rows(test.df,x1)
  
   #round3 - Years 2010:2019
  x2 <- filter(df.inputs.wages, df.inputs.wages$Dist.Code == y & df.inputs.wages$Year >=2010 & df.inputs.wages$Year <= 2019)
  
  x2$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x2$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.), mean(x2$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x2$DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day.)
  
  x2$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x2$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.), mean(x2$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x2$DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day.)

  x2$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x2$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.), mean(x2$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x2$STATE.MALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.)

  x2$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day. <- ifelse( is.na(x2$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.), mean(x2$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.,na.rm = T),x2$STATE.FEMALE.AVERAGE.FIELD.LABOUR..Rs.per.Day.)
  
  test.df <- bind_rows(test.df,x2)
  
}

df.inputs.wages <- test.df
#removing test.df from environment
rm(test.df)
rm(x)
rm(x1)
rm(x2)
```

## Handling NA values of df.inputs.season.fertilizer.consumption

```{r}
#replace -1 by NA

df.inputs.season.fertilizer.consumption$NITROGEN.KHARIF.CONSUMPTION..tons. <-
  ifelse(df.inputs.season.fertilizer.consumption$NITROGEN.KHARIF.CONSUMPTION..tons. == -1,NA,df.inputs.season.fertilizer.consumption$NITROGEN.KHARIF.CONSUMPTION..tons.)

df.inputs.season.fertilizer.consumption$NITROGEN.RABI.CONSUMPTION..tons.<-
  ifelse(df.inputs.season.fertilizer.consumption$NITROGEN.RABI.CONSUMPTION..tons. == -1,NA,df.inputs.season.fertilizer.consumption$NITROGEN.RABI.CONSUMPTION..tons.)


df.inputs.season.fertilizer.consumption$PHOSPHATE.KHARIF.CONSUMPTION..tons. <-
  ifelse(df.inputs.season.fertilizer.consumption$PHOSPHATE.KHARIF.CONSUMPTION..tons. == -1,NA,df.inputs.season.fertilizer.consumption$PHOSPHATE.KHARIF.CONSUMPTION..tons.)


df.inputs.season.fertilizer.consumption$PHOSPHATE.RABI.CONSUMPTION..tons. <-
  ifelse(df.inputs.season.fertilizer.consumption$PHOSPHATE.RABI.CONSUMPTION..tons. == -1,NA,df.inputs.season.fertilizer.consumption$PHOSPHATE.RABI.CONSUMPTION..tons.)


df.inputs.season.fertilizer.consumption$POTASH.KHARIF.CONSUMPTION..tons. <-
  ifelse(df.inputs.season.fertilizer.consumption$POTASH.KHARIF.CONSUMPTION..tons. == -1,NA,df.inputs.season.fertilizer.consumption$POTASH.KHARIF.CONSUMPTION..tons.)


df.inputs.season.fertilizer.consumption$POTASH.RABI.CONSUMPTION..tons. <-
  ifelse(df.inputs.season.fertilizer.consumption$POTASH.RABI.CONSUMPTION..tons. == -1,NA,df.inputs.season.fertilizer.consumption$POTASH.RABI.CONSUMPTION..tons.)


df.inputs.season.fertilizer.consumption$TOTAL.KHARIF.CONSUMPTION..tons. <-
  ifelse(df.inputs.season.fertilizer.consumption$TOTAL.KHARIF.CONSUMPTION..tons. == -1,NA,df.inputs.season.fertilizer.consumption$TOTAL.KHARIF.CONSUMPTION..tons.)


df.inputs.season.fertilizer.consumption$TOTAL.RABI.CONSUMPTION..tons. <-
  ifelse(df.inputs.season.fertilizer.consumption$TOTAL.RABI.CONSUMPTION..tons. == -1,NA,df.inputs.season.fertilizer.consumption$TOTAL.RABI.CONSUMPTION..tons.)


#create a test data frame with 0 rows and 13 columns
test.df <- data.frame(Dist.Code = integer(),
                      Year = integer(),
                      State.Code = integer(),
                      State.Name = character(),
                      Dist.Name = character(),
                      NITROGEN.KHARIF.CONSUMPTION..tons. = double(),
                      NITROGEN.RABI.CONSUMPTION..tons. = double(),
                      PHOSPHATE.KHARIF.CONSUMPTION..tons. = double(),
                      PHOSPHATE.RABI.CONSUMPTION..tons. = double(),
                      POTASH.KHARIF.CONSUMPTION..tons. = double(),
                      POTASH.RABI.CONSUMPTION..tons. = double(),
                      TOTAL.KHARIF.CONSUMPTION..tons. = double(),
                      TOTAL.RABI.CONSUMPTION..tons. = double(),
                      stringsAsFactors = F
                      )

dist <- c(44,45,46,47,48,49,50,51,52,53,54,503,504)
for(y in dist){
  # here we only have missing data for 1998 & 1999
  #round1 - 1990:1999
  x <- filter(df.inputs.season.fertilizer.consumption, df.inputs.season.fertilizer.consumption$Dist.Code == y & df.inputs.season.fertilizer.consumption$Year >=1990 & df.inputs.season.fertilizer.consumption$Year <= 1999)
  
  x$NITROGEN.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x$NITROGEN.KHARIF.CONSUMPTION..tons.), mean(x$NITROGEN.KHARIF.CONSUMPTION..tons.,na.rm = T),x$NITROGEN.KHARIF.CONSUMPTION..tons.)
  
  x$NITROGEN.RABI.CONSUMPTION..tons. <- ifelse( is.na(x$NITROGEN.RABI.CONSUMPTION..tons.), mean(x$NITROGEN.RABI.CONSUMPTION..tons.,na.rm = T),x$NITROGEN.RABI.CONSUMPTION..tons.)

  x$PHOSPHATE.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x$PHOSPHATE.KHARIF.CONSUMPTION..tons.), mean(x$PHOSPHATE.KHARIF.CONSUMPTION..tons.,na.rm = T),x$PHOSPHATE.KHARIF.CONSUMPTION..tons.)

  x$PHOSPHATE.RABI.CONSUMPTION..tons. <- ifelse( is.na(x$PHOSPHATE.RABI.CONSUMPTION..tons.), mean(x$PHOSPHATE.RABI.CONSUMPTION..tons.,na.rm = T),x$PHOSPHATE.RABI.CONSUMPTION..tons.)
   
  x$POTASH.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x$POTASH.KHARIF.CONSUMPTION..tons.), mean(x$POTASH.KHARIF.CONSUMPTION..tons.,na.rm = T),x$POTASH.KHARIF.CONSUMPTION..tons.)

  x$POTASH.RABI.CONSUMPTION..tons. <- ifelse( is.na(x$POTASH.RABI.CONSUMPTION..tons.), mean(x$POTASH.RABI.CONSUMPTION..tons.,na.rm = T),x$POTASH.RABI.CONSUMPTION..tons.)

  x$TOTAL.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x$TOTAL.KHARIF.CONSUMPTION..tons.), mean(x$TOTAL.KHARIF.CONSUMPTION..tons.,na.rm = T),x$TOTAL.KHARIF.CONSUMPTION..tons.)
  
    x$TOTAL.RABI.CONSUMPTION..tons. <- ifelse( is.na(x$TOTAL.RABI.CONSUMPTION..tons.), mean(x$TOTAL.RABI.CONSUMPTION..tons.,na.rm = T),x$TOTAL.RABI.CONSUMPTION..tons.)
  
  test.df <- bind_rows(test.df,x)
  #round2 - 2000:2009
   x1 <- filter(df.inputs.season.fertilizer.consumption, df.inputs.season.fertilizer.consumption$Dist.Code == y & df.inputs.season.fertilizer.consumption$Year >=2000 & df.inputs.season.fertilizer.consumption$Year <= 2009)
  
  x1$NITROGEN.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x1$NITROGEN.KHARIF.CONSUMPTION..tons.), mean(x1$NITROGEN.KHARIF.CONSUMPTION..tons.,na.rm = T),x1$NITROGEN.KHARIF.CONSUMPTION..tons.)
  
  x1$NITROGEN.RABI.CONSUMPTION..tons. <- ifelse( is.na(x1$NITROGEN.RABI.CONSUMPTION..tons.), mean(x1$NITROGEN.RABI.CONSUMPTION..tons.,na.rm = T),x1$NITROGEN.RABI.CONSUMPTION..tons.)

  x1$PHOSPHATE.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x1$PHOSPHATE.KHARIF.CONSUMPTION..tons.), mean(x1$PHOSPHATE.KHARIF.CONSUMPTION..tons.,na.rm = T),x1$PHOSPHATE.KHARIF.CONSUMPTION..tons.)

  x1$PHOSPHATE.RABI.CONSUMPTION..tons. <- ifelse( is.na(x1$PHOSPHATE.RABI.CONSUMPTION..tons.), mean(x1$PHOSPHATE.RABI.CONSUMPTION..tons.,na.rm = T),x1$PHOSPHATE.RABI.CONSUMPTION..tons.)
   
  x1$POTASH.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x1$POTASH.KHARIF.CONSUMPTION..tons.), mean(x1$POTASH.KHARIF.CONSUMPTION..tons.,na.rm = T),x1$POTASH.KHARIF.CONSUMPTION..tons.)

  x1$POTASH.RABI.CONSUMPTION..tons. <- ifelse( is.na(x1$POTASH.RABI.CONSUMPTION..tons.), mean(x1$POTASH.RABI.CONSUMPTION..tons.,na.rm = T),x1$POTASH.RABI.CONSUMPTION..tons.)

  x1$TOTAL.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x1$TOTAL.KHARIF.CONSUMPTION..tons.), mean(x1$TOTAL.KHARIF.CONSUMPTION..tons.,na.rm = T),x1$TOTAL.KHARIF.CONSUMPTION..tons.)
  
    x1$TOTAL.RABI.CONSUMPTION..tons. <- ifelse( is.na(x1$TOTAL.RABI.CONSUMPTION..tons.), mean(x1$TOTAL.RABI.CONSUMPTION..tons.,na.rm = T),x1$TOTAL.RABI.CONSUMPTION..tons.)
  
  test.df <- bind_rows(test.df,x1)
  #round3 - 2010:2019
   x2 <- filter(df.inputs.season.fertilizer.consumption, df.inputs.season.fertilizer.consumption$Dist.Code == y & df.inputs.season.fertilizer.consumption$Year >=2010 & df.inputs.season.fertilizer.consumption$Year <= 2019)
  
  x2$NITROGEN.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x2$NITROGEN.KHARIF.CONSUMPTION..tons.), mean(x2$NITROGEN.KHARIF.CONSUMPTION..tons.,na.rm = T),x2$NITROGEN.KHARIF.CONSUMPTION..tons.)
  
  x2$NITROGEN.RABI.CONSUMPTION..tons. <- ifelse( is.na(x2$NITROGEN.RABI.CONSUMPTION..tons.), mean(x2$NITROGEN.RABI.CONSUMPTION..tons.,na.rm = T),x2$NITROGEN.RABI.CONSUMPTION..tons.)

  x2$PHOSPHATE.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x2$PHOSPHATE.KHARIF.CONSUMPTION..tons.), mean(x2$PHOSPHATE.KHARIF.CONSUMPTION..tons.,na.rm = T),x2$PHOSPHATE.KHARIF.CONSUMPTION..tons.)

  x2$PHOSPHATE.RABI.CONSUMPTION..tons. <- ifelse( is.na(x2$PHOSPHATE.RABI.CONSUMPTION..tons.), mean(x2$PHOSPHATE.RABI.CONSUMPTION..tons.,na.rm = T),x2$PHOSPHATE.RABI.CONSUMPTION..tons.)
   
  x2$POTASH.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x2$POTASH.KHARIF.CONSUMPTION..tons.), mean(x2$POTASH.KHARIF.CONSUMPTION..tons.,na.rm = T),x2$POTASH.KHARIF.CONSUMPTION..tons.)

  x2$POTASH.RABI.CONSUMPTION..tons. <- ifelse( is.na(x2$POTASH.RABI.CONSUMPTION..tons.), mean(x2$POTASH.RABI.CONSUMPTION..tons.,na.rm = T),x2$POTASH.RABI.CONSUMPTION..tons.)

  x2$TOTAL.KHARIF.CONSUMPTION..tons. <- ifelse( is.na(x2$TOTAL.KHARIF.CONSUMPTION..tons.), mean(x2$TOTAL.KHARIF.CONSUMPTION..tons.,na.rm = T),x2$TOTAL.KHARIF.CONSUMPTION..tons.)
  
    x2$TOTAL.RABI.CONSUMPTION..tons. <- ifelse( is.na(x2$TOTAL.RABI.CONSUMPTION..tons.), mean(x2$TOTAL.RABI.CONSUMPTION..tons.,na.rm = T),x2$TOTAL.RABI.CONSUMPTION..tons.)
  
  test.df <- bind_rows(test.df,x2)
}

df.inputs.season.fertilizer.consumption <- test.df
#removing test.df from environment
rm(test.df)
rm(x)
rm(x1)
rm(x2)

```


## Merging Reductant columns 

Since there are many columns in dataset, we like to reduce some redundant columns by talking average of months by general agricultural seasons in India.

Kharif - July - October

Rabi - November - April

Zaid - March - June

But now for analysis reasons, we consider Rabi to be only November to February.


```{r}
#calculating means of columns and created 3 new columns.
#df.biophysical.monthly.rainfall
df.biophysical.monthly.rainfall$Zaid.rainfall.mm <- rowMeans(df.biophysical.monthly.rainfall[,c("MARCH.RAINFALL..Millimeters.","APRIL.RAINFALL..Millimeters.","MAY.RAINFALL..Millimeters.","JUNE.RAINFALL..Millimeters.")])
df.biophysical.monthly.rainfall$Kharif.rainfall.mm <- rowMeans(df.biophysical.monthly.rainfall[,c("JULY.RAINFALL..Millimeters.","AUGUST.RAINFALL..Millimeters.","SEPTEMBER.RAINFALL..Millimeters.","OCTOBER.RAINFALL..Millimeters.")])
df.biophysical.monthly.rainfall$Rabi.rainfall.mm <- rowMeans(df.biophysical.monthly.rainfall[,c("NOVEMBER.RAINFALL..Millimeters.","DECEMBER.RAINFALL..Millimeters.","JANUARY.RAINFALL..Millimeters.","FEBRUARY.RAINFALL..Millimeters.")])

#df.environment.evapotranspiration.actual
df.environment.evapotranspiration.actual$Zaid.evapotranspiration.actual.mm<-
  rowMeans(df.environment.evapotranspiration.actual[,c("MARCH.ACTUAL..Millimeters.","APRIL.ACTUAL..Millimeters.","MAY.ACTUAL..Millimeters.","JUNE.ACTUAL..Millimeters.")])
df.environment.evapotranspiration.actual$Kharif.evapotranspiration.actual.mm<-
  rowMeans(df.environment.evapotranspiration.actual[,c("JULY.ACTUAL..Millimeters.","AUGUST.ACTUAL..Millimeters.","SEPTEMBER.ACTUAL..Millimeters.","OCTOBER.ACTUAL..Millimeters.")])
df.environment.evapotranspiration.actual$Rabi.evapotranspiration.actual.mm<-
  rowMeans(df.environment.evapotranspiration.actual[,c("NOVEMBER.ACTUAL..Millimeters.","DECEMBER.ACTUAL..Millimeters.","JANUARY.ACTUAL..Millimeters.","FEBRUARY.ACTUAL..Millimeters.")])


#df.environment.evapotranspiration.potential
df.environment.evapotranspiration.potential$Zaid.evapotranspiration.potential.mm<-
  rowMeans(df.environment.evapotranspiration.potential[,c("MARCH.POTENTIAL..Millimeters.","APRIL.POTENTIAL..Millimeters.","MAY.POTENTIAL..Millimeters.","JUNE.POTENTIAL..Millimeters.")])
df.environment.evapotranspiration.potential$Kharif.evapotranspiration.potential.mm<-
  rowMeans(df.environment.evapotranspiration.potential[,c("JULY.POTENTIAL..Millimeters.","AUGUST.POTENTIAL..Millimeters.","SEPTEMBER.POTENTIAL..Millimeters.","OCTOBER.POTENTIAL..Millimeters.")])
df.environment.evapotranspiration.potential$Rabi.evapotranspiration.potential.mm<-
  rowMeans(df.environment.evapotranspiration.potential[,c("NOVEMBER.POTENTIAL..Millimeters.","DECEMBER.POTENTIAL..Millimeters.","JANUARY.POTENTIAL..Millimeters.","FEBRUARY.POTENTIAL..Millimeters.")])

#df.environment.precipitation
df.environment.precipitation$Zaid.percipitation.mm <- rowMeans( df.environment.precipitation[,c("MARCH.PERCIPITATION..Millimeters.","APRIL.PERCIPITATION..Millimeters.","MAY.PERCIPITATION..Millimeters.","JUNE.PERCIPITATION..Millimeters.")])
df.environment.precipitation$Kharif.percipitation.mm <- rowMeans( df.environment.precipitation[,c("JULY.PERCIPITATION..Millimeters.","AUGUST.PERCIPITATION..Millimeters.","SEPTEMBER.PERCIPITATION..Millimeters.","OCTOBER.PERCIPITATION..Millimeters.")])
df.environment.precipitation$Rabi.percipitation.mm <-rowMeans( df.environment.precipitation[,c("NOVEMBER.PERCIPITATION..Millimeters.","DECEMBER.PERCIPITATION..Millimeters.","JANUARY.PERCIPITATION..Millimeters.","FEBRUARY.PERCIPITATION..Millimeters.")])


#df.environment.temperature.maximum

df.environment.temperature.maximum$Zaid.temp.max.c <- rowMeans(df.environment.temperature.maximum[,c("MARCH.MAXIMUM..Centigrate.","APRIL.MAXIMUM..Centigrate.","MAY.MAXIMUM..Centigrate.","JUNE.MAXIMUM..Centigrate.")])
df.environment.temperature.maximum$Kharif.temp.max.c <- rowMeans(df.environment.temperature.maximum[,c("JULY.MAXIMUM..Centigrate.","AUGUST.MAXIMUM..Centigrate.","SEPTEMBER.MAXIMUM..Centigrate.","OCTOBER.MAXIMUM..Centigrate.")])
df.environment.temperature.maximum$Rabi.temp.max.c <- rowMeans(df.environment.temperature.maximum[,c("NOVEMBER.MAXIMUM..Centigrate.","DECEMBER.MAXIMUM..Centigrate.","JANUARY.MAXIMUM..Centigrate.","FEBRUARY.MAXIMUM..Centigrate.")])

#df.environment.temperature.minimum

df.environment.temperature.minimum$Zaid.temp.min.c <- rowMeans(df.environment.temperature.minimum[,c("MARCH.MINIMUM..Centigrate.","APRIL.MINIMUM..Centigrate.","MAY.MINIMUM..Centigrate.","JUNE.MINIMUM..Centigrate.")])
df.environment.temperature.minimum$Kharif.temp.min.c <- rowMeans(df.environment.temperature.minimum[,c("JULY.MINIMUM..Centigrate.","AUGUST.MINIMUM..Centigrate.","SEPTEMBER.MINIMUM..Centigrate.","OCTOBER.MINIMUM..Centigrate.")])
df.environment.temperature.minimum$Rabi.temp.min.c <- rowMeans(df.environment.temperature.minimum[,c("NOVEMBER.MINIMUM..Centigrate.","DECEMBER.MINIMUM..Centigrate.","JANUARY.MINIMUM..Centigrate.","FEBRUARY.MINIMUM..Centigrate.")])

```

## Deleting columns 

Deleting all other columns ( January to December), state name ,and district name.

```{r}
library(dplyr)
#dropping all other columns
df.biophysical.monthly.rainfall <- select(df.biophysical.monthly.rainfall,1:3,19:21)
df.environment.evapotranspiration.actual <- select(df.environment.evapotranspiration.actual,1:3,18:20)

df.environment.evapotranspiration.potential <- select(df.environment.evapotranspiration.potential,1:3,18:20)
df.environment.precipitation <- select(df.environment.precipitation,1:3,18:20)
df.environment.temperature.maximum <- select(df.environment.temperature.maximum,1:3,18:20)
df.environment.temperature.minimum <- select(df.environment.temperature.minimum,1:3,18:20)



df.rice.area.production.yield <- select(df.rice.area.production.yield, -c("State.Name","Dist.Name"))
df.rice.farm.harvest.price <- select(df.rice.farm.harvest.price,-c("State.Name","Dist.Name"))
df.irrigation.rice.area <- select(df.irrigation.rice.area,-c("State.Name","Dist.Name"))
df.irrigation.sourcewise.irrigated.area <- select(df.irrigation.sourcewise.irrigated.area,-c("State.Name","Dist.Name"))
df.inputs.wages <- select(df.inputs.wages,-c("State.Name","Dist.Name"))
df.inputs.season.fertilizer.consumption <- select(df.inputs.season.fertilizer.consumption,-c("State.Name","Dist.Name"))
df.inputs.fertilizer.consumption <- select(df.inputs.fertilizer.consumption,-c("State.Name","Dist.Name"))

df.biophysical.landuse <- select(df.biophysical.landuse,-c("State.Name","Dist.Name"))
df.biophysical.length.of.growing.period <- select(df.biophysical.length.of.growing.period,-c("State.Name","Dist.Name"))

df.biophysical.soil.type1 <- select(df.biophysical.soil.type1,-c("State.Name","Dist.Name"))

```

# Data Transformation 

## Merging all data frames

Now that our datasets are ready, we will try to combine all those data sets to a single DF.

We are going to use $\textbf{joins from dplyr package}$ here. We are going to use full join because we don't want to loose any data. 
we will plan to handle the missing values later.

We are getting lot of rows due to cartesian product. As per discussion with Professor,k decided to move on with join on Year and concentrate on new data first.



```{r}


combine1 <- full_join(df.rice.area.production.yield,df.rice.farm.harvest.price,by = c("Dist.Code","State.Code","Year"))
combine2 <- full_join(combine1,df.irrigation.sourcewise.irrigated.area,by = c("Dist.Code","State.Code","Year"))
combine3 <- full_join(combine2,df.irrigation.rice.area,by = c("Dist.Code","State.Code","Year"))
combine4 <- full_join(combine3,df.inputs.wages,by = c("Dist.Code","State.Code","Year"))
combine5 <- full_join(combine4,df.inputs.season.fertilizer.consumption,by = c("Dist.Code","State.Code","Year"))
combine6 <- full_join(combine5,df.inputs.fertilizer.consumption,by = c("Dist.Code","State.Code","Year"))
combine7 <- full_join(combine6,df.environment.temperature.minimum,by = c("Dist.Code","State.Code","Year"))
combine8 <- full_join(combine7,df.environment.temperature.maximum,by = c("Dist.Code","State.Code","Year"))
combine9 <- full_join(combine8,df.environment.precipitation,by = c("Dist.Code","State.Code","Year"))
combine10 <- full_join(combine9,df.environment.evapotranspiration.potential,by = c("Dist.Code","State.Code","Year"))
combine11 <- full_join(combine10,df.environment.evapotranspiration.actual,by = c("Dist.Code","State.Code","Year"))
combine12 <- full_join(combine11,df.biophysical.monthly.rainfall,by = c("Dist.Code","State.Code","Year"))
combine13 <- full_join(combine12,df.biophysical.landuse,by = c("Dist.Code","State.Code","Year"))
combine14 <- full_join(combine13,df.biophysical.length.of.growing.period,by = c("Dist.Code","State.Code"))
df.all <- full_join(combine14,df.biophysical.soil.type1,by = c("Dist.Code","State.Code"))

#dropping Year and Year.y and State.Code(because we only have one state)
df.all = subset(df.all, select = -c(Year,Year.y,State.Code))

```

Data Processing Notes:

Initially, our final dataframe consists of 884 observations with 137 predictors.
But by taking averages of columns season-wise, and deleting repeated columns(columns after taking averages), we reduced predictors from 137 to 80 and 780 observations.
By taking data starting from years 1990 we reduced no.of observations from 780 to 364.
After handling NAs,our observations got down to 338.

Maximum NAs have been produced by the only reason that 5 tables were starting from 1950's while every other table is starting from 1990.

After handling NULL values, 
Now after checking df.all we have 2 null values in df.rice.farm.price-paddy for 503,504(1995).
and
26 NUll values in wages for all districts for years(2010,2011)

All NAs are handled.

These are not present before, they are formed during joins. need to check joins individually.

## Normalization : Standard scaling method

As we can see from above dataframes, we have each column in different numerical range. Some are in range of 0-100 while some are in range or 10k - 100k.
So this affects for future analysis, we will bring them to some range.

We are using regular scaling method 

$z = \frac{x-\bar{x}}{s}$ to scale

$z = (x\times s)+\bar{x}$ for re-scaling back.

```{r}
#creating a data frame to hold the values of mean and sd for every column, the same vlaues will be utilised for rescaling 

df.stats <- data.frame(
  names = character(),
  m = double(),
  s = double(),
  stringsAsFactors = F
)

# creating statistics function
stats = function(x){
  m = mean(x)
  s = sd(x)
  return(list(m,s))
}

#collecting colnames of dataFrame.
names.list <- names(df.all)

#trying to add col names as rows for new df.
for (i in names.list){
  if(i != c("Dist.Code") & i != c("Year.x")){
    st = stats(unlist(df.all[i]))
    df.stats[nrow(df.stats)+1,]<- c(i,st[[1]],st[[2]])
  }
}

```

```{r}
#scaling function.

#standardizing
for (i in names.list){
  x = 1
  while(x <= nrow(df.stats)){
  if(i == df.stats[x,'names']){
    #print(i)
    m = df.stats[1,'m']
    s = df.stats[1,'s']
    k = unlist(df.all[i])
    z <- (k - as.numeric(m)) / as.numeric(s)
    df.all[i] <- z
  }
    x = x+1
  }
}


```


## Factorising data


```{r}
#factorising
df.all$Dist.Code <- as.factor(df.all$Dist.Code)
#df.all$Year.x <- as.factor(df.all$Year.x)
#df.all$State.Code <- as.factor(df.all$State.Code)

```




finding corelation:
because of too many variables, we could not find this correlation to be much usefull.

```{r}
# library(caret)
# library(corrplot)
# corMatrix <- cor(df.all)
# corrplot(corMatrix)
```

# Data Visualization

```{r}
library(ggplot2)
library(ggsci)
ggplot(data = df.all, aes(x = Year.x, y = PADDY.HARVEST.PRICE..Rs.per.Quintal., group = Dist.Code, col = Dist.Code)) +
  geom_point() +
  geom_line() +
  theme_classic(base_size = 10) +
  theme(axis.text.x = element_text(angle = 90))+
  ylab("Rice Farm Harvest Price (Rs.)") + 
  xlab("Year") +
  ggtitle("Rice FHP in Andhra Pradesh by Year and District")

```

Increase in harvest price can be due to inflation. However major changes in price occurred between 2010 and 2015.

Now lets look at how production of rice has been over the years:

```{r}
ggplot(data = df.all, aes(x = Year.x, y = RICE.PRODUCTION..1000.tons., group = Dist.Code, col = Dist.Code)) +
  geom_point() +
  geom_line() +
  theme_classic(base_size = 10) +
  theme(axis.text.x = element_text(angle = 90))+
  ylab("Rice Production (1000 tons)") + 
  xlab("Year") +
  ggtitle("Rice Production in Andhra Pradesh by Year and District")
```

```{r}
ggplot(data = df.all, aes(x = Year.x, y = RICE.YIELD..Kg.per.ha., group = Dist.Code, col = Dist.Code)) +
  geom_point() +
  geom_line() +
  theme_classic(base_size = 10) +
  theme(axis.text.x = element_text(angle = 90))+
  ylab("Rice Yield (kg/Ha)") + 
  xlab("Year") +
  ggtitle("Rice Yield in Andhra Pradesh by Year and District")
```

Despite some major dips across the districts in rice production during the early 2000s, the production of rice seems to be mostly the same throughout the years. This could mean two things: the increase in price of the years could be due to inflation as we had originally assumed, or there were other factors that played a more significant role in increasing the prices. Judging by the data we have at hand, most variables play a role into the production of rice. The possible predictors that can influence price greatly outside of rice production would be the wages for each worker. 

Lets take a look at how the wages have changed per district across the years:

```{r}
ggplot(data = df.all, aes(x = Year.x, y = DISTRICT.MALE.FIELD.LABOUR..Rs.per.Day., group = Dist.Code, color = Dist.Code)) +
  geom_point() +
  geom_line() +
  theme_classic(base_size = 10) +
  theme(axis.text.x = element_text(angle = 90))+
  ylab("Male Labor Wages (Rs. per day)") + 
  xlab("Year") +
  ggtitle("Male Labor Wages by Year and District")
```

```{r}
ggplot(data = df.all, aes(x = Year.x, y = DISTRICT.FEMALE.FIELD.LABOUR..Rs.per.Day., group = Dist.Code, color = Dist.Code)) +
  geom_point() +
  geom_line() +
  theme_classic(base_size = 10) +
  theme(axis.text.x = element_text(angle = 90))+
  ylab("Female Labor Wages (Rs. per day)") + 
  xlab("Year") +
  ggtitle("Female Labor Wages by Year and District")
```

As we can see from the visuals, the wages for the workers have increased steadily until 2007. From 2008-2015 the wages have increased rapidly. This reflects what we saw with the price of harvest as well. This makes intuitive sense because as the cost of workers go up, the prices the farmers charge will reflect that. This further supports our initial assumption of inflation playing a key factor in the increase of rice harvest prices. Now that we have a general idea of the data, we can go into the statistics of the data and see what features play a role in price that we cannot see so easily.


# Model building

## Train,Test Split


```{r}
#data splitting.

#Here we are splitting the data to train and test where we took data from 1990 to 2010 as training data and data from 2010 as testing data. 

#So, technically we are predicting future results.

data.train <- df.all[df.all$Year.x <= 2010,]
data.test <- df.all[df.all$Year.x > 2010,]


```

## General Models - Linear Regression

```{r}
library(olsrr)
set.seed(108)

#all predictors model
model.all <- lm(PADDY.HARVEST.PRICE..Rs.per.Quintal.~., data = data.train)
summary(model.all)
```

Our model.all with all predictor variables gave an Adjusted r-squared value of 0.9293.

## AIC model

Model selection/variable selection.

We will use AIC and forward prediction because AIC will helps us to prevent overfitting.

Here we are using forward selection process to select the predictors.

```{r}
#forward selection
fwdfit.aic <- ols_step_forward_aic(model.all)

#summary of model
fwdfit.aic

#final model
fwdfit.aic$model

summary(fwdfit.aic$model)

```

Our fwdfit.aic model gave Adjusted R-squared values of 0.9765 with only 23 predictors which indicates a very good model compared to model.all

```{r}
#AIC model plot

plot(fwdfit.aic)
#plotting final model characteristics
par(mfrow=c(2,2))
plot(fwdfit.aic$model)
#plotting final model residuals.
par(mfrow=c(3,2))
plot(fwdfit.aic$ess,main = "Residuals SS vs Predictor",xlab = "Predictor",ylab = "Residuals SS")
plot(fwdfit.aic$rsq,main = "R-squared vs Predictor",xlab = "Predictor",ylab = "R-squared")
plot(fwdfit.aic$arsq,main = "Adjusted R-squared vs Predictor",xlab = "Predictor",ylab = "Adjusted R-squared")
plot(fwdfit.aic$aics,main = "AIC vs Predictor",xlab = "Predictor",ylab = "AIC")
plot(fwdfit.aic$rss,main = "Regression SS vs Predictor",xlab = "Predictor",ylab = "Regression SS")
```

## Lasso regression

```{r}
library(glmnet)

#perform k-fold cross-validation to find optimal lambda value
cv_model <- cv.glmnet(model.matrix(PADDY.HARVEST.PRICE..Rs.per.Quintal.~., data = data.train)[,-6],data.train$PADDY.HARVEST.PRICE..Rs.per.Quintal.,alpha = 1)

summary(cv_model)

#find optimal lambda value that minimizes test MSE
best_lambda <- cv_model$lambda.min
best_lambda


#produce plot of test MSE by lambda value
plot(cv_model) 

#find coefficients of best model
best_model <- glmnet(model.matrix(PADDY.HARVEST.PRICE..Rs.per.Quintal.~., data = data.train)[,-6],data.train$PADDY.HARVEST.PRICE..Rs.per.Quintal., alpha = 1, lambda = best_lambda)

#coeffiecients of lasso best model
coef(best_model)

#summary of lasso best model.
summary(best_model)
```

## coefficeints of lasso
```{r}
coef.lasso<- predict(best_model,type = "coefficients",s= best_lambda)
coef.lasso

#coeffs of full model  \beta
coef(model.all)
```


We an clearly see that compared to the linear fit, our Lasso Regularization has shrinked the coefficients and we can also notice that most of them are shrinked to almost zero.

# Results 

## Data Rescaling

```{r}
#rescaling function
#DE-standardizing
for (i in names.list){
  x = 1
  while(x <= nrow(df.stats)){
    if(i == df.stats[x,'names']){
      #print(i)
      m = df.stats[1,'m']
      s = df.stats[1,'s']
      k = unlist(df.all[i])
      z <- ((k * as.numeric(s)) + as.numeric(m))
      df.all[i] <- z
    }
    x = x+1
  }
}

```

## Train,test,split - rescaled data

Since, here we are only splitting data based on year and its not a random shuffling, so now we are splitting data again for rescaled data and we will run our model on re-scaled observations.

```{r}
#data split
data.train <- df.all[df.all$Year.x <= 2010,]
data.test <- df.all[df.all$Year.x > 2010,]

```


## Testing Model with all predictors

```{r}
#testing predictions
prediction.all.test <- predict(model.all,newdata = data.test)
testing.df1 <- data.test%>% mutate(pred.all.model.test = prediction.all.test)
plot(testing.df1$PADDY.HARVEST.PRICE..Rs.per.Quintal.,testing.df1$pred.all.model.test,main = "All predictor Model: Actual vs Predicted values: Test data",xlab = " PADDY.HARVEST.PRICE..Rs.per.Quintal - Actual data",ylab = "Predicted data")

#RMSE for all predictor model
#sqrt(mean((data$actual - data$predicted)^2))

RMSE.test <- sqrt(mean((testing.df1$PADDY.HARVEST.PRICE..Rs.per.Quintal. - testing.df1$pred.all.model.test)^2))
RMSE.test


```

We can see that our model with all predictors did not correctly predict the results, the predictions were too bad. And RMSE is around 3076.591


## Testing AIC model

```{r}
#training predictions
prediction.train <- predict(fwdfit.aic$model,newdata = data.train)
training.df1 <- data.train%>% mutate(pred.reg.train = prediction.train)
plot(training.df1$PADDY.HARVEST.PRICE..Rs.per.Quintal.,training.df1$pred.reg.train,main = "AIC model: Actual vs Predicted values: Train data",xlab = "PADDY.HARVEST.PRICE..Rs.per.Quintal - Actual data",ylab = "Predicted data")

#testing predictions
prediction.test <- predict(fwdfit.aic$model,newdata = data.test)
testing.df1 <- data.test%>% mutate(pred.reg.test = prediction.test)
plot(testing.df1$PADDY.HARVEST.PRICE..Rs.per.Quintal.,testing.df1$pred.reg.test,main = "AIC Model: Actual vs Predicted values: Test data",xlab = " PADDY.HARVEST.PRICE..Rs.per.Quintal - Actual data",ylab = "Predicted data")


#Calculating RMSE
RMSE.train <- sqrt(mean((training.df1$pred.reg.train-training.df1$PADDY.HARVEST.PRICE..Rs.per.Quintal.)^2))
RMSE.train

#sqrt(mean((data$actual - data$predicted)^2))

RMSE.test <- sqrt(mean((testing.df1$PADDY.HARVEST.PRICE..Rs.per.Quintal. - testing.df1$pred.reg.test)^2))
RMSE.test
```



## Testing lasso regression model

```{r}
#use lasso regression model to predict response value

prediction.test.lasso <- predict(best_model,s=best_lambda,newx = model.matrix(PADDY.HARVEST.PRICE..Rs.per.Quintal.~., data = data.test)[,-6])

#plotting results

testing.df1 <- data.test%>% mutate(pred.lasso.test = prediction.test.lasso)
plot(testing.df1$PADDY.HARVEST.PRICE..Rs.per.Quintal.,testing.df1$pred.lasso.test,main = "Lasso Model: Actual vs Predicted values: Test data",xlab = " PADDY.HARVEST.PRICE..Rs.per.Quintal - Actual data",ylab = "Predicted data")

#RMSE
#sqrt(mean((data$actual - data$predicted)^2))

RMSE.test.lasso <- sqrt(mean((testing.df1$PADDY.HARVEST.PRICE..Rs.per.Quintal. - testing.df1$pred.lasso.test)^2))

RMSE.test.lasso


```

# Conclusion:

After carefully cleaning, processing and transforming our data, we could reduce the number of parameters from $137$ to $77$. Feature engineering also helped us in reducing reductant rows that were created during joining the dataframes.

Even $77$ features is a very large for observations of size $338$. We tested this by creating Linear Regression model with all $77$ parameters and our test RMSE is $3076.591$.

So, we decided to further reduce the features by choosing any of the available feature selection models, so we decided to choose AIC and Lasso to compare the results.

Our test RMSE for AIC model is  $304.8638$, our test RMSE for Lasso model is  $281.5105$

We can see both of our models predicted good results compared to Model with all predictors.







